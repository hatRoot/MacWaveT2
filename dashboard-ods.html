<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ODS - MacWave GSX</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            /* Apple GSX / macOS Dark Mode Palette */
            --mac-bg: #000000;
            --mac-sidebar: #1C1C1E;
            --mac-card: #1C1C1E;
            --mac-card-hover: #2C2C2E;
            --mac-border: #38383A;
            --mac-text: #F5F5F7;
            --mac-text-muted: #8E8E93;
            --mac-blue: #0A84FF;
            --mac-green: #30D158;
            --mac-red: #FF453A;
            --mac-input-bg: #2C2C2E;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--mac-bg);
            color: var(--mac-text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Header */
        header {
            background: #111;
            height: 52px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--mac-border);
            flex-shrink: 0;
            -webkit-app-region: drag;
            /* Mac app feel */
        }

        .header-title {
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-title span.badge {
            background: var(--mac-border);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            color: var(--mac-text-muted);
            text-transform: uppercase;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            background: var(--mac-card);
            border: 1px solid var(--mac-border);
            color: var(--mac-text);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--mac-card-hover);
        }

        .btn-primary {
            background: var(--mac-blue);
            color: #fff;
            border-color: var(--mac-blue);
        }

        .btn-primary:hover {
            background: #0071E3;
        }

        .btn-danger {
            color: var(--mac-red);
        }

        /* Main Workspace */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar - List View */
        .sidebar {
            width: 320px;
            background: var(--mac-sidebar);
            border-right: 1px solid var(--mac-border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 12px;
            border-bottom: 1px solid var(--mac-border);
        }

        .search-box {
            width: 100%;
            background: var(--mac-input-bg);
            border: 1px solid transparent;
            padding: 8px 30px 8px 12px;
            border-radius: 8px;
            color: var(--mac-text);
            font-size: 13px;
            outline: none;
            transition: border 0.2s;
        }

        .search-box:focus {
            border-color: var(--mac-blue);
        }

        .search-wrapper {
            position: relative;
        }

        .search-wrapper::after {
            content: '';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            opacity: 0.5;
            pointer-events: none;
        }

        .list-container {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .list-item {
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: background 0.1s;
        }

        .list-item:hover {
            background: var(--mac-card-hover);
        }

        .list-item.selected {
            background: var(--mac-blue);
        }

        .list-item.selected .item-subtitle,
        .list-item.selected .status-dot-text {
            color: rgba(255, 255, 255, 0.8) !important;
        }

        .item-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .item-subtitle {
            font-size: 11px;
            color: var(--mac-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Status Dot Indicator */
        .status-dot-text {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: var(--mac-text-muted);
            margin-top: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--mac-border);
        }

        /* Detail View */
        .detail-view {
            flex: 1;
            background: var(--mac-bg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .empty-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--mac-text-muted);
            text-align: center;
        }

        .empty-selection svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Detail Header */
        .detail-header {
            padding: 30px 40px 20px;
            border-bottom: 1px solid var(--mac-border);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .folio-title {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
        }

        .status-pill {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid transparent;
        }

        /* Detail Content Grid */
        .detail-content {
            padding: 30px 40px;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 2fr 1.2fr;
            gap: 30px;
        }

        /* Left Column: Info & Setup */
        .info-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--mac-card);
            border: 1px solid var(--mac-border);
            border-radius: 10px;
            padding: 20px;
        }

        .card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--mac-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 11px;
            color: var(--mac-text-muted);
        }

        .form-control {
            background: var(--mac-input-bg);
            border: 1px solid var(--mac-border);
            color: var(--mac-text);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
            transition: border 0.2s;
        }

        .form-control:focus {
            border-color: var(--mac-blue);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }

        /* Financial Field */
        .price-input {
            position: relative;
        }

        .price-input::before {
            content: '$';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--mac-text-muted);
        }

        .price-input input {
            padding-left: 24px;
            width: 100%;
            font-weight: 600;
            color: var(--mac-red);
        }

        /* Right Column: Timeline & Actions */
        .action-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .timeline-container {
            margin-top: 10px;
            padding-left: 10px;
        }

        .timeline-item {
            position: relative;
            padding-left: 24px;
            margin-bottom: 24px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 4px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--mac-border);
            border: 2px solid var(--mac-bg);
            z-index: 2;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 14px;
            bottom: -24px;
            width: 2px;
            background: var(--mac-border);
            z-index: 1;
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-date {
            font-size: 11px;
            color: var(--mac-text-muted);
            margin-bottom: 4px;
        }

        .timeline-status {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .timeline-note {
            font-size: 13px;
            line-height: 1.4;
            color: var(--mac-text);
            background: var(--mac-input-bg);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--mac-border);
        }

        .timeline-img {
            margin-top: 8px;
            max-width: 100%;
            border-radius: 6px;
            border: 1px solid var(--mac-border);
        }

        /* Scrollbar styling for a native feel */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #4A4A4C;
            border-radius: 4px;
            border: 2px solid var(--mac-bg);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6e6e73;
        }

        @media (max-width: 850px) {
            .workspace {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 40vh;
                border-right: none;
                border-bottom: 1px solid var(--mac-border);
            }

            .detail-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .detail-header {
                padding: 20px;
            }
        }
    </style>
</head>

<body>

    <!-- Auth Check -->
    <script>
        if (sessionStorage.getItem('macwave_session') !== 'authorized') {
            window.location.href = 'tecnicos.html';
        }
    </script>

    <header>
        <div class="header-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
            MacWave Service <span class="badge">GSX Portal</span>
        </div>
        <div class="header-actions">
            <a href="cotizaciones.html" class="btn">Volver a Cotizaciones</a>
            <button class="btn btn-danger" id="logout-btn">Cerrar Sesi贸n</button>
        </div>
    </header>

    <div class="workspace">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="search-wrapper">
                    <input type="text" id="search-input" class="search-box"
                        placeholder="Buscar folio, cliente o serie...">
                </div>
            </div>
            <div class="list-container" id="ods-list">
                <!-- Items populated by JS -->
                <div style="padding: 20px; text-align: center; color: var(--mac-text-muted); font-size: 12px;">Cargando
                    贸rdenes...</div>
            </div>
        </aside>

        <main class="detail-view" id="detail-view">
            <div class="empty-selection">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
                <h3>Ninguna ODS Seleccionada</h3>
                <p style="margin-top: 8px; font-size: 13px;">Selecciona una orden de servicio en la lista de la
                    izquierda.</p>
            </div>
        </main>
    </div>

    <script>
        // Supabase Init
        const _sbUrl = 'https://lifxtyhvgnxjjqgbzare.supabase.co';
        const _sbKey = 'sb_publishable_7aBPXbWRwrltSuXtzsyg-g_L1Fu3rTT';
        const supabaseClient = window.supabase.createClient(_sbUrl, _sbKey);

        document.getElementById('logout-btn').onclick = () => {
            sessionStorage.clear();
            window.location.href = 'tecnicos.html';
        };

        const STATUS_CONFIG = {
            'Recibido': { color: '#0A84FF' }, // Blue
            'Diagn贸stico': { color: '#FFD60A' }, // Yellow
            'Espera de aprobaci贸n y pago': { color: '#FF9F0A' }, // Orange
            'Espera de piezas': { color: '#8E8E93' }, // Gray
            'Reparaci贸n': { color: '#FF9F0A' }, // Orange
            'Equipo reparado': { color: '#30D158' }, // Green
            'Equipo entregado': { color: '#BF5AF2' }, // Purple
            'Equipo sin reparar': { color: '#FF453A' }, // Red
            'Nota General': { color: '#8E8E93' } // Gray
        };

        let allODS = [];
        let currentSelectedId = null;

        function getStatusColor(status) {
            return STATUS_CONFIG[status] ? STATUS_CONFIG[status].color : '#8E8E93';
        }

        async function loadData() {
            const { data, error } = await supabaseClient
                .from('ordenes_servicio')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                document.getElementById('ods-list').innerHTML = `<div style="color:var(--mac-red); padding:15px; font-size:12px; text-align:center;">Error: ${error.message}</div>`;
                return;
            }
            allODS = data || [];
            renderSidebar();
        }

        function renderSidebar(query = '') {
            const listContainer = document.getElementById('ods-list');
            listContainer.innerHTML = '';

            const filtered = allODS.filter(o => {
                const q = query.toLowerCase();
                return (o.folio || '').toLowerCase().includes(q) ||
                    (o.cliente || '').toLowerCase().includes(q) ||
                    (o.serie || '').toLowerCase().includes(q);
            });

            if (filtered.length === 0) {
                listContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--mac-text-muted); font-size: 12px;">No hay resultados</div>';
                return;
            }

            filtered.forEach(o => {
                const color = getStatusColor(o.status);
                const item = document.createElement('div');
                item.className = `list-item ${o.id === currentSelectedId ? 'selected' : ''}`;
                item.innerHTML = `
                    <div class="item-title">
                        <span>${o.folio}</span>
                        <span style="font-size: 11px; opacity: 0.7;">${(o.fecha || '').split(' ')[0]}</span>
                    </div>
                    <div class="item-subtitle">${o.cliente || 'Sin cliente'}</div>
                    <div class="status-dot-text">
                        <div class="status-dot" style="background: ${color}; ${o.id === currentSelectedId ? 'border-color: #fff;' : ''}"></div>
                        ${o.status || 'Recibido'}
                    </div>
                `;
                item.onclick = () => {
                    currentSelectedId = o.id;
                    renderSidebar(document.getElementById('search-input').value);
                    renderDetail(o);
                };
                listContainer.appendChild(item);
            });
        }

        document.getElementById('search-input').addEventListener('input', (e) => {
            renderSidebar(e.target.value);
        });

        function renderDetail(o) {
            const detailView = document.getElementById('detail-view');
            const statusColor = getStatusColor(o.status);

            let historial = [];
            try {
                historial = JSON.parse(o.notas || '[]');
                if (!Array.isArray(historial)) throw new Error('Not array');
            } catch (e) {
                if (o.notas) historial = [{ date: o.fecha || '', status: 'Nota General', text: o.notas, img: null }];
            }

            const statusOptions = Object.keys(STATUS_CONFIG).filter(s => s !== 'Nota General').map(s =>
                `<option value="${s}" ${s === o.status ? 'selected' : ''}>${s}</option>`
            ).join('');

            const timelineHtml = historial.slice().reverse().map(ev => {
                const evColor = getStatusColor(ev.status);
                return `
                <div class="timeline-item">
                    <style>.timeline-item::before { border-color: ${evColor} !important; }</style>
                    <div class="timeline-date">${ev.date}</div>
                    <div class="timeline-status" style="color: ${evColor}">${ev.status}</div>
                    ${ev.text ? `<div class="timeline-note">${ev.text.replace(/\\n/g, '<br>')}</div>` : ''}
                    ${ev.img ? `<img src="${ev.img}" class="timeline-img">` : ''}
                </div>
                `;
            }).join('') || '<div style="font-size:12px; color:var(--mac-text-muted);">Sin historial registrado.</div>';

            detailView.innerHTML = `
                <div class="detail-header">
                    <div>
                        <div class="status-pill" style="color: ${statusColor}; background: ${statusColor}1A; border-color: ${statusColor}4D; margin-bottom: 8px;">
                            ${o.status || 'Recibido'}
                        </div>
                        <h2 class="folio-title">${o.folio}</h2>
                        <div style="font-size: 13px; color: var(--mac-text-muted);">ID del Sistema: ${o.id}</div>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="btn btn-primary" id="btn-save-meta">Guardar Cambios</button>
                        <button class="btn btn-danger" id="btn-delete" style="border-color: var(--mac-red);">Eliminar</button>
                    </div>
                </div>

                <div class="detail-content">
                    <!-- Left: Information Form -->
                    <div class="info-section">
                        <div class="card">
                            <div class="card-title">Informaci贸n del Cliente y Equipo</div>
                            <div class="form-grid">
                                <div class="form-group" style="grid-column: span 2;">
                                    <label>Cliente</label>
                                    <input type="text" id="inp-cliente" class="form-control" value="${o.cliente || ''}" placeholder="Nombre del cliente">
                                </div>
                                <div class="form-group">
                                    <label>Proyecto / Equipo</label>
                                    <input type="text" id="inp-proyecto" class="form-control" value="${o.proyecto || ''}" placeholder="Ej. MacBook Pro A2338">
                                </div>
                                <div class="form-group">
                                    <label>N煤mero de Serie</label>
                                    <input type="text" id="inp-serie" class="form-control" value="${o.serie || ''}" style="font-family: monospace;" placeholder="C02...">
                                </div>
                                <div class="form-group">
                                    <label>T茅cnico Asignado</label>
                                    <input type="text" id="inp-tecnico" class="form-control" value="${o.tecnico || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Fecha de Entrada</label>
                                    <input type="text" id="inp-fecha" class="form-control" value="${o.fecha || ''}">
                                </div>
                                <div class="form-group" style="grid-column: span 2;">
                                    <label>Monto de Cotizaci贸n / Venta</label>
                                    <div class="price-input">
                                        <input type="number" id="inp-monto" class="form-control" value="${o.monto || '0'}" step="0.01">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Update Form -->
                        <div class="card" style="border-color: var(--mac-green);">
                            <div class="card-title" style="color: var(--mac-green);">Registrar Avance</div>
                            <div class="form-group" style="margin-bottom: 12px;">
                                <label>Nuevo Estatus</label>
                                <select id="inp-new-status" class="form-control">
                                    ${statusOptions}
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 12px;">
                                <label>Anotaciones (Visibles en el Status de Cliente)</label>
                                <textarea id="inp-new-text" class="form-control" placeholder="Describe los avances, piezas pedidas o finalizaci贸n del servicio..."></textarea>
                            </div>
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label>Evidencia Fotogr谩fica (Opcional)</label>
                                <input type="file" id="inp-new-img" accept="image/*" class="form-control" style="padding: 6px;">
                                <canvas id="ev-canvas" style="display:none;"></canvas>
                            </div>
                            <button class="btn btn-primary" id="btn-add-event" style="width: 100%; justify-content: center; background: var(--mac-green); border-color: var(--mac-green);">Actualizar Historial</button>
                        </div>
                    </div>

                    <!-- Right: Timeline -->
                    <div class="action-section">
                        <div class="card" style="background: transparent; border: none; padding: 0;">
                            <div class="card-title">Secuencia de Reparaci贸n</div>
                            <div class="timeline-container">
                                ${timelineHtml}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Bind Event Listeners
            document.getElementById('btn-save-meta').onclick = async function () {
                const btn = this;
                btn.innerText = 'Guardando...';
                btn.disabled = true;

                try {
                    const updates = {
                        cliente: document.getElementById('inp-cliente').value,
                        proyecto: document.getElementById('inp-proyecto').value,
                        serie: document.getElementById('inp-serie').value,
                        tecnico: document.getElementById('inp-tecnico').value,
                        fecha: document.getElementById('inp-fecha').value,
                        monto: parseFloat(document.getElementById('inp-monto').value) || 0
                    };

                    const { error } = await supabaseClient.from('ordenes_servicio').update(updates).eq('id', o.id);
                    if (error) throw error;

                    Object.assign(o, updates);
                    const idx = allODS.findIndex(x => x.id === o.id);
                    if (idx > -1) allODS[idx] = o;

                    renderSidebar(document.getElementById('search-input').value);
                    alert('Informaci贸n guardada correctamente.');
                } catch (e) {
                    alert('Error: ' + e.message);
                } finally {
                    btn.innerText = 'Guardar Cambios';
                    btn.disabled = false;
                }
            };

            document.getElementById('btn-delete').onclick = async () => {
                if (!confirm(`驴Eliminar la orden ${o.folio} permanentemente?`)) return;
                try {
                    const { error, count } = await supabaseClient.from('ordenes_servicio').delete({ count: 'exact' }).eq('id', o.id);
                    if (error) throw error;
                    if (count === 0) return alert('No se pudo borrar, revise RLS en Supabase.');

                    allODS = allODS.filter(x => x.id !== o.id);
                    currentSelectedId = null;
                    renderSidebar(document.getElementById('search-input').value);
                    document.getElementById('detail-view').innerHTML = '<div class="empty-selection"><h3>Orden Eliminada</h3></div>';
                } catch (e) {
                    alert('Error: ' + e.message);
                }
            };

            document.getElementById('btn-add-event').onclick = async function () {
                const btn = this;
                const newStatus = document.getElementById('inp-new-status').value;
                const text = document.getElementById('inp-new-text').value;
                const fileInput = document.getElementById('inp-new-img');
                const file = fileInput.files[0];

                if (!newStatus) return alert("Selecciona un estatus");

                btn.innerText = "Procesando...";
                btn.disabled = true;

                try {
                    let base64Img = null;
                    if (file) {
                        base64Img = await new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.getElementById('ev-canvas');
                                    const ctx = canvas.getContext('2d');
                                    const MAX_WIDTH = 800; const MAX_HEIGHT = 800;
                                    let width = img.width; let height = img.height;
                                    if (width > height) { if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } }
                                    else { if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; } }
                                    canvas.width = width; canvas.height = height;
                                    ctx.drawImage(img, 0, 0, width, height);
                                    resolve(canvas.toDataURL('image/jpeg', 0.65));
                                };
                                img.onerror = () => reject(new Error('Formato inv谩lido'));
                                img.src = e.target.result;
                            };
                            reader.onerror = () => reject(new Error('Error de lectura'));
                            reader.readAsDataURL(file);
                        });
                    }

                    const now = new Date();
                    const dateStr = now.toLocaleDateString('es-MX', { day: '2-digit', month: '2-digit', year: 'numeric' }) + ' ' + now.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });

                    historial.push({ date: dateStr, status: newStatus, text: text, img: base64Img });
                    const newNotasString = JSON.stringify(historial);

                    const { error } = await supabaseClient.from('ordenes_servicio').update({ status: newStatus, notas: newNotasString }).eq('id', o.id);
                    if (error) throw error;

                    o.status = newStatus;
                    o.notas = newNotasString;
                    const idx = allODS.findIndex(x => x.id === o.id);
                    if (idx > -1) { allODS[idx].status = newStatus; allODS[idx].notas = newNotasString; }

                    renderSidebar(document.getElementById('search-input').value);
                    renderDetail(o);

                } catch (e) {
                    alert('Error: ' + e.message);
                    btn.innerText = "Actualizar Historial";
                    btn.disabled = false;
                }
            };
        }

        // Run
        loadData();
    </script>
</body>

</html>